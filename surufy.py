# Author: Eskander Bejaoui.

from os import listdir
from pathlib import Path
from wand.image import Image
from wand.color import Color
from wand.drawing import Drawing
from colorthief import ColorThief
from gi.repository import Gio

# icon sizes to watch in hicolor directory
hicolor = [
    '32x32',
    '48x48',
    '64x64',
    '96x96',
    '256x256',
    '512x512',
]

# icon sizes to generate
sizelist = [
    '32x32',
    '48x48',
    '256x256',
    '32x32@2x',
    '48x48@2x',
    '256x256@2x',
]

# icons and patterns to be excluded
exclude = [
    'goa-',
    'gcr-',
    'gdm-',
    'preferences-',
    'symbolic',
    'ubuntu-logo-icon.png',
    'distributor-logo.png',
]

# correspond sizes and folders from hicolor to Yaru
redirect = {
    '32x32': '32x32',
    '48x48': '48x48',
    '64x64': '32x32@2x',
    '96x96': '48x48@2x',
    '256x256': '256x256',
    '512x512': '256x256@2x',
}

# percentage by which original icons should be downscaled to fit into the background (I think 80% is optimal here)
percentage = 70

# which color to choose from each icon's color palette (0 = primary)
palette = 0

# transparency values
alpha_value = 0.5
fuzz_value = 0.3

# background image stored as bytes
background = b'\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\x02\x00\x00\x00\x02\x00\x08\x03\x00\x00\x00\xc3\xa6$\xc8\x00\x00\x0f\xe5zTXtRaw profile type exif\x00\x00x\xda\xad\x9ak\x96\x1c\xa9\xae\x85\xff3\x8a3\x04\xc4\x9b\xe1\x00\x82\xb5\xee\x0c\xee\xf0\xcf\xa7\x88\xa8\xa7\xddn\xfb\xa4+\xbb+\xb2"#AhK[[`\xb7\xff\xff\xff\x8e\xfb\x0f?\xa9Ks)\xd7Vz)\x9e\x9f\xd4S\x0f\x837\xcd\xdf?\xf7U|\xba~\xbf\xfd\x84\xe7\xee\x97\xfb\xee\xfd\x83\xc0\xad\xc85\xde\x1f\x94}_ep?\x7f|\xa1\xa6\xe7\xfe\xfcz\xdf\xd5\xf5L\xd3\x9e\x81\xdef~\x06\x8c6\xb3M\xf5<\xd7\x9e\x81b\xb8\xef\xcb\xf3\xb7\xeb\xcf\xf7F\xfa\xb4\x9c\xe7\xff\xf3\xb6\xc4z_\xbe\xff\x9d*\xce\xd0\xccx1\xb8\xb0\xa3D\xcf\xefb\xb3D,\x88-\x0e~\x0b\xbf\xb9\x13\xecNy\xbf\x13\xa2\xfc\xdcw\xee\xfd\xad\xfc\xe0T\xf9\x99\xef\xfcx\xee\xc7\xaf\xaep\xbe<\x0f\x94o>z\xeeK\xfe\xb9\xef.\x0f}\xb6H>f\xfe\xf2\x81\x1c\t\xfe\xf3\xcfg\xdf\x1dm\xe7\xec{u#\x15<U\xdc\xb3\xa8\xb7\xa5\\\xefxp\xe2\xcax}\xad\xf0\xaa\xfc\x9fy_\xafW\xe7\xd5X\xe2\x021\x05\xcd\xc9k9\xe9\x12\xf0\xf6\x91$*\x03;\xf6u]\xb201\x85\x1d*\xd7\x10\x16^\xb6{-\xd6\xd0\xc3\xba@I\xf6\x92\x13j\xecQ\x1d\x18\x85\xb8@-r;\xbc\xdb"\xd7\xbc\xfd\x9aoIcf\x15\x9e\x0c\xc2`\xc27~x\xb9\x9f\xdd\xfc_^\xef\x03\x9dc\xa1+\xe2\xdb\xbb\xaf\xb0+\x98\xc31\xc3\x90\xb3\xdf<\x95\x0c\x88\xc7\xa7\xf9\xf2\xef\xf5r\x9f\xe2\xc6\x7f\x026\x82`\xbe\xdc\xdcX\xe0\xf0\xf3\x1ebf\xf9\x88\xadx\xe1\x1cy.\xfb\xe4\xfc\x9d\x1aR\xf5\x19\x00\x171w\xc6\x18b9\x89/\x12\xb3\x14\xf15\x84*\x82\x1f\x1b\xf8\x0c,\x0f1\x85\t\x02\x92sPq\x07lb,\x80\xd3\x82\xcd\xcdw\xaa\\\xcf\x86\x1c\xee\xdbP\x0b@d\x12\xa5\x02M\x8f\x03\xb0R\xca\xc4OM\x8d\x18\x1a9\xe6\xe4r\xce%\xd7\xdcr\xcf\xa3\xc4\x92J.\xa5\xd4b\x1c5j\xac\xa9\xe6Zj\xad\xad\xf6:Zl\xa9\xe5VZm\xad\xf56z\xe8\x11\n\xcb\xbd\xf4\xeaz\xeb\xbd\x8f\xc1\xa4\x83\xa1\x07\xdf\x1e<1\xc6\x0c3\xce4\xf3,\xb3\xce6\xfb\x1c\x8b\xf0Yi\xe5UV]m\xf554hT\xd2_\x8bV\xa7M\xbb\x8e-\x9bP\xdai\xe7]v\xddm\xf7=\x0e\xb1v\xe2I\'\x9fr\xeai\xa7\x9f\xf1\x8e\xda\x83\xeaW\xd4\xe4\x1br\xbfFM\x1e\xd4\x0c\xb1t=W?P\xe3v\xadoC\x88\xd1I6\xcc@,$\x01\xf1j\x08\x10\xd0\xc10\xf3MR\n\x86\x9ca\xe6{ )r\x005\xc9\x06\x8e\x8a!\x06\x82iK\xc8G\xde\xb1\xfb@\xee\x97\xb8\xb9\x9c\xfe\x08\xb7\xf0O\xc89\x83\xeeo \xe7\x0c\xba\x07\xb9\x1fq\xfb\tj:\xae\x8a\x12/\x80,\x0b\xcd\xa7>\x1e\x88\x8d\x87Fh\xfc\x07\x1f\xffp\xed=$|\x1a\xfa\xdc,?\xe5\x93Kl\x92\x9b\xd6\n\xf3\x1c`lK\xf1luu\x87\xa4$y\x1f\xf1L\xe8\xad\xd7)\xadf{\xaa\xc2X\xcc\xafk\x84\xd9\xeb9xQ\xb6\xc7*f\x10\xb2\xe6z\xb7<\xae]\xf58>\xd6y<k\xd8\xad\xc8\xf5Q\x0f\xd3(\x19?{\xd9`\x9dk\xb7\xfb\x07\xfa\xd3\xd3\xec\x0f\x98\xcf\xeel\x9c\xcc\x18\xc7\xea\xae\xc3\x90-\xb5\x1c\x9cx\xce\xc0\x98sB\x1a;\xda\xc7M\x95b8\xa0\x82\xbc\xb9o,4g%\x0b\xea\x81\xaby\xa4\x87\\\xef\xc9\x8b\xdb\xed\xfa\xcaW\xb3\x1e\xa3\x98\xf3\xabY\xf6\x95w\xb3.J\xc6\xf2\xdb,wd~1\xca\xd6\xdf.s\x1f\xc3\xbe\x99\xc5\x12\xbf\x99\xe5\xbd\x19\xe6l\xfebf\xbd\xe8+\xf7\xe6\xacW}\xe5\xde\x9c\xf5\xaa\xaf\xdc\x9b\xb3\xccW\xfa\x0c\xf6\x84\xcb[\xb0\\\xa1\xc2`\x16\xa6\x8b\x9c9\xd2q\xc48\xa3\xb4-\xf6g(]\\$0\xab\xae6\xe2\xd4\xb6\xb0\x98\xa7\xe6\xecK\xcbZ9\xa6\x1cG/m$db\x92U2\x94 \x16\xa5U1\xceDV~\xae.\x7f\xbbA\n\xec\xa9;4\x95\xb9b\xf4+\x9d1\x14\x7f\x91w\xb1(\x15\x82\xea\xb3s\xef3\x18]\xc5\xbc&\xc5\xbc{J6\x13\xa5RF;\xad\xd5E\xd6\x90%\x8bI\x0b\xd4(\xeb\x0c\xf2\xb8O\xd8a\x95\x12fh@\xb1f\xee\x17D%\xe7Mz\xe8\x0ce\xb8\x82oOK\xd0C"\xb3\xd2\xdc8(+\xd5\xa7\xf5Y\xf1\xe5\xe8Y\xb7\x8cR}\xda\xb5\x8cSR:p\xda\xf2\xdb\xa4h\xc9^3\xf1\xa3\xc3\x9d`\xc6\xa7\xd2:\x7f\x85<\xe2\x16f\x1d*,\x05\x14dw\x9fJ\xdd9j\xdc\x87\xda\x1a\xfb\x8e\x10\xa2V*\xe3\xe8z\xb6\xf1\xd0$EH]\xddEz\x9b\tv\xcce\x15\x81\xf2)\xf9\x104^\x82K\xda\x1e\xbb\x86\x04\x15l\xac\xeb\xe6IY-\x19\x87\xcc\x05\x1b\x83\xd6:\xd1a\x8a\xe8\xce\xd0\x1e\x94\xdec>\x00^\x89\x91\x99\x18\x0fu\x01O\xb7\x93\x16\xa1J\x19\x98R\xf2\x96t\xfc.\x1d\x1fw\xa2\x01\xad\x15\x86\x96\xecJ\xd6\x91\xb7\x9f\x11\x98\xda8\x1e\xf8}\x1c\x15\xce\xe3\xf3j\xf4\x16\x08\x1fx\x11\xdf\x83a4hN\xe6\x96/\x95G,6.\nt\xff\xc8\x8d\xffpm\x03\no\xa6\xe3\x16\xe9Q![\xf5\x93b\xee\xdaY\x1b\xc2\xe7!\xca\xd6\xa9\x90\xeaf\xd5i\x98\x08!Qdd0\xa4\x0e\xe0\xc2uJ\x959\t\xa3\xb4#NK;\x9dM\xf99\x91\xaf\xb9}<\xaa\xd4Bx\xc5\xc1\xa7T\x1eJ`9a\x97)=o\xca\x02\xb5\x13\xf4\xa8Ty!1g\xdfg\x8f2\xc7\xb9foJ\x00%\xe2\x88"J\x9dASJ/3\x96\xdaK\x0e\xd3+\x00\xcd\xddr\x82\x93A\xb0\xfbbI\x08\x03\xc4\xb6$\xaeb\x11@\xf2\xc11E\xbd\x95Eu\xc0\x94f\xd1\xb2\x95\x92\xbc\x82\xe5\x10\xf5\x8e\xdc\xf6\x18My8\x11#\x0e\xef{\\U\xb4\xccy\xfbA\x8eMN\xfc\x91N\x14Sh\x04\xf4\xe0\x93R\x1bN\\\xc7\xf4\x1c\xf27(%\x1d\xcd<\x890\\\x81\x96m\x1b\x89m\x01\xc0\xfaH&\x840\x92\x8c\xfcQ\xd1\x93\xf0\x84\xdbd\x01\x196)\x9c8U#\x81\xc0Zj\xa4\xbeN\xc2`\x0c\xc2\xb4\x92KH\x99C\x95.\x14N*%\xd1\x83\x05\xe8\x80\xbc\x9a \xbdgp\xa4w\xb6Rvq/\xfe\xadg\xaf55\xa73\x8b7bLj\xb4\x90\xad+ig\x07|\xcf"#\x994\xa7jf\x9d\x85\x14m\xddE\x131\x831\xfa@\x95H\x89&sB\xdd\xe4:\xc2\'N\xc0#\xeb\x1b\xe0\x08\x15\x94i\x02\x02\x82\x18\x8ecF%\x1c\'\xde\x1dcm7H\r\x88p\x93#8an\xcb\x16"\x7f\x90\xe9\x14\xd9z<\xb2\xa3\xe2\n\x7f\xd2\xac=\x90\xdf\x10qn\xf8\xff\xcc\xb4\x07\xa6\x91\xf6\x04\x87\x0bq[R\x0e\x12a\x05H\x89ud\xf5\xcfb\xd2\xef_\xdd\x9f~\xe1\xf6\xd6\xc2\xf1\xd4\x1b\x12\x92\x00\x1d9\xa4\xee\xa0K\xbc7VFy\x9d\xd2\x95EA\x06)\xa4\x05/C\xdcH\x10B \x17Q\x12vP\\HWr\x0c\x0e)sub\xe8x\xc5W\xc3\x8di\xfd\x12%\x0c\xb5\xb5Q\x9f\xd6;\x91\xd4\x00\x1a\x0c\x06\xe6\x9c\xc6f\xa23^A\x94K\xa7M \x18\x1b\x02\x0e>%\xea\xf7\x9aI]\xa1\x05\x1d3\x05\xb2\x81\x14\xaf\x19>\xeb\xd00\xe9H\xdd\x1a\x10\xda\xacQ\x87\xc53`N\xea&\xf6\xa0\xbc0\xb6r\xddAjK\x04$:{\xd8T\xa9,A\x0f\xf5\xeear\xb4a\x9eH\xb6\x05\\\xf4&G+\x81\xa7\xc0\xc5\'A\xa9\x83\\R\x08\xdd\x02\xa4.\xe8\xa4\x06D\x04kE\x04`)\x94\x1d\xa1\x01\x88\xb7\xe2\xca,\x84\xdb\x9aa/?rG\xad\xb1\xa2\x9d\x88\x01\xa5\xfa\x11OD8\x8c\xab\xed\xbd\x8a\xb9\xefe\xed\x7f\xbd\xfe\xcb@B\x89i\xf0M\x1f\xd5HC\xa8\x1epv\xa0\x0e\x9b\nf\xb9\x0b\xa2\xc7\xc3K\\\xa5\xa3%\tH7$\tU\xf3\xe2\x1b,OZ\x8b\x9a(X\x104q2I.\x08\x8bN \xd6\xce\x80c\xa1\xab\xab$\x183J\xae\xcdu-\x89\xe6\xb7\xf2\xbdm\xf1\x0eT\xc8W:b@\xa0t\xad\x01\xeds\x03\xda\xc7\x1a\xa8\x90\x02\x0cC\x10^\xb4\xf0f\xde%;\xda\xa0\xae\xd1&\xc4\x9a52\x0e\xc4\xd7\xc3\xc5\xb3\xda`Wh}CA\xc5\x88\x1c\xde\xa4\x02m \x14\xd8\xaaP\xe4\xad\xa0\xd2\xd2\xb7\xbc\x06=Gr3,\xd2\x13ct"Z\x06q\xa6\x91\xa8c\xa25q\xc0\x89\xa9Q9\xca\xea\xb4\xaaV\xe2\xba)\xee,T\xa4\xd4\xc0Zk"\xa8D\x9a\x0b\xf0\x03\xd9\xb1zS\x1f6+d\xc989\xe8\x1f\xc2\xe6^\xc4\x9d\x92\xbd\xc3\x9c\x01b\xcb\x81\xf2\xba\t1\xf1\xe4\xd7"#\xa0\xb0\x15X\xbb\xb5\xca4\x04\xc5\xc7\xd8\xb6R\xec\x10r47\xf0\xbfI\xd2F\xe5B;\xe2\xabT\xf1\xb0#|isH\xfe\t\xace\xd2z\xd0\xcdX\xef\xa0\xa8\xa2F\x14\x83y\n\x88\x98\xd5@/\xee\xde\xa9\xec\x14\xb9K\xb4\x90\xc4uE,\xd9\xd3q\r\x94\xdc\x19\x92%.}Q\xc9\xa7\xe7F\xda\x92\xfc\x16}X_)\'\xd5\xc4&_\xa0\'-\xfb\x92\xa3\x83\xb6TM\xeb\x9a"]\xae\xe8-\xb9S\x1c\xdb\xde\xa9=J"\xd1\xef\x99\x88\xfdmg\xb9\xd7\xb3\xec}\xa0[+/$\xda\xb9\x0c\xa3")\xa1{\x99\xd5\xcd\xac\xa7u\xf0i\xde\xcbk\x99\xe5\x1dy\x96\x17\xf2\xb5\xfd\xe5>/\xde\xb61\xaf&\xe1\xcb\xf2M\xce\xeb3\xc9\xb6\r\xa6\xeb\xc9\xef\xabw\x7f\x85C~{\xa0\x0b\x17[\xfb\x03\xcbOV\xefl\xf9\x9f\x17\xcf\xf2l\xf9\x1f\x8b\xffW\xe0o\xdc\xdd\xeb\xc0\xdfW\xf77\\d\x86\xb9\xd7\x81\xbf\xd7\xee^\x07\xfe\xbe\xba\xbfTD\xfeu\xa0\xdf\x00\xfe\xc6\xdd\xbd\x0e\xfc\xbdr\xf7:\xf0\xf7\xd5\xbd\x0e\xfc\x8d\xbb{\x1d\xf8{\xed\xeeu\xe0\xffN\x15\xf9\x8d\x81~\x1b\xf8{y\xeeG\xe0\xcb\xa0\xd9\xde-\xd8&\x04M\xc6\x0e\x14\x96\x11\xa9\xffR\xd2\xdeT\xfeu\x90\xf4\'\x06z\x06\xbaw9\x8b\xeaQ\xdd,=Y\xcd\xf1k\xd1|Rsd\x8a\xd5\x1c\xda\xcctD\xb3m\xd1Q\xc3\x10y\x94:Z-S\x93\x89\xf2\xae(\x07\xdb\xa6\x99\xa6e\xa2\x1d\xf9d4c\xce\xfd\x80\xc6\xa6\xdf\xef\xe8<k\x98(\xf2\x98`\xe3\xf8F\xcbC\x8f\xd5\x90$Jg\x1d\xad\xd8mS%,\xd0:K;/\xbaZ\xd1\xeb\xcd\xab\xd7_\x0fd5\x95\x0e\xcfZ\xfaH\xa1Dh\x0b\xca{ \xa3\xa9\xc9\xe6\xc1\xe8\xd3\xa3\\\xa8\xb4\xa3\x134\xb7t\xa1-\xcbrK\x97R\xa2I\x97\x1e\x91.\x05/\x11N%)\xdd\xab\x9c\xa1z\xac\xdd\xd0\xa0\x13\x9d\x8f\xdbi\x7f\x1cJ\xbdds\xdd\xda4m\x92\xf1\x1eBw\x7f\xa81\xd4\x85\xb5C\xb7\x18\xd3C7\xea\x1f1\x86\x18j\xd1\xc4\x18\x1d\x15u\rE\x9c\x90\x90(\x0bA;\xd1\xa8\xe6d\xc8\x04\x94\xe1\xa2\x05\x0f}\xceJ`\x13\x08\xe8y\\\x1fQ\x91\xcc\x96\xe8J\xd1\x0b\x0b\xb1`\xfb!\xeah\x94\xd0\x17B\'_\xd0y\xd6(hG\x1f\x9em\xe2a/\xdcs\xe8\xa9l\xc3,z\xb4\x10\xe2\xf1\xf2\x8f\xa6\x80y\x01\x85\n\xb8a\x8c\xe3\xc8/\xba\xb0Et\xd20\xd8\xb9_\x9cm\xfc\xe9\xae\xc2\x8d\xda\x9f}\xe1\xd35\xda^!\xbd$\x8a\x0cY\x83\x03\x01\xa8\xd1D\xc4]\xe7\x05\x051<i\xba\xc3\xa23BN\x03\xf1\x19e\x03\x06$P\xf3\xd8\x13g\xb7$\xa4\x15\xaa\x16\xd7\xa2\xe0[pt\x9f\xde\x9a\xd6I\xb6\xad\xfe\xb4=\x82\xc8?,\x16!8\xb7\xe6N\xe7\x81\x0e\xe7\x83E\xcbBJ\x8d5w\x8b\xb4X\xca\xf4\x0b\x01\x9f\xd5\xad\xbb#L\xa6\xea\x91\xf9!\x9eC\x17\x9cP\xfdx\xbd\x97E\x7f\x85\xac\x04J\xba\xde\xd1R\xee\xa0\x8e\x18\xdfs\xed\xccW\xc6\xa9\xc8Kz\x1eG\xa3K\x1f\xa8t\xf5\x08\xbd\xd0\xac\x1f\xd4\x8d\x18\x8f\xc0\x8c\xa1\xde6\xc5\xfd\xecv"7F\xa5\xe1\xa0\xc7\xf0\xb5\xa1P\x87X\xfb<m\x8f\x1au\xea\xf2im\xe7#\xb0\xe9H\x19\x93\n\xe1\xda\'\xd6\xcdX\xe8\xe0i(\n\xa2\x92\x0c\xc1I\xd0\x06\x1d\xb8_\xe41Tq\xf0W\xff\x1b\xa8\xfd\x1e\xfc\xbbP\xb7Xt\xec\x08`\xe5\x8e\x9dh\xa1\x98\xc1\xf8\xd0\x82.\x1d\xf4"-\xe3\x87\x02\x93Uq}7O\x02\xaei\tB\x88\xab\x11\r\x0e\xaap\x99Z\x9c\xc8X{\xf0\x00$D\x92\xe0\x93\xdd\xb3\x87\x1e\xe9\xbe4N\xe1kg\x9f\xd9]\xe5m\x07]jJ5R\xf40\x1b\x89I;Nzm\x8d\t\x8f\xd1\xf6\xf1e\xb1#\x8d\x06G\\\xbb\x1f\x11\xe3,\x1f\xe8\xf6\xc4\xce3\xd0\xd9\xfa\xb13P\x03\x9dE\xb7M\xbd\xd1\xce\x18\x99\xb8\xb4\x1d\x15\x1a\xfa\x0c\xe0\xd6\x89\xad\xd9aX\x1a$\xf2\x7f\x0b\th;\x890tpq\x0ckuY\xcaj\xb6G=m\xd3\xa8\xe3\x9c\xc0\xbc\x93V\xb4\x17\x16\xa7s\xa7|\xf5\x8cv\x96sh\xb8\xe6\x86\xa9zjF)b\xffp\xc0\x1a\x88t\x11=}J\xaathB\x15\x84\x8a\x00\xbe\x87\xd5iD\xe80\x03\xdd\x87\x9d\x00\xb6d\x01\x9d\xc9tZ\xca\xee-\x02\x9eXr\x8bj\x05\xd5\xd3\xb1l\xe1\x13\xaa\x04K\x1a,\xa9\xd0B&\x0b\xd5\x9c\x8fj\xbe\x1c`\xf1\xdea\x97\\A\xe6\x10\xdc\xbe\x12z)\x02\x8c\x93R\xd5l>\x01K\xa9\x88}\x1c\nT&\'\xc9\xb0 \xcd\x10\xb6]R\xfc\xd3\xc9\x88J\xdd:\xe9\xe8u\xf4rR\xc0\x16\xeb9\x19(\xecC\x1e\xe4\xe0u\'\x0brH5\x0coG\x9a\xe4\x11\x1f\xec\x15\xab\x9d\x83c\xef\xd03\x03\xad\x15e\x8e.\xaf\xb7EgG\x0f\x0f\x0f\xe60\xdc\xd8\xe0d{\x94\x10\x85\xd4&}\xf9\xc8|rhb}\x99*\x86\'\xb4x\x88\x99\xdcX\xf3\xc0<\xbav\x92.@\xf1\xe1\rs\xf7\x87\xdbG\xbc\x9b6\xac\x9d\xf3\xf6\xc2\xb0\x91:\x1b\xa0UG\xcb\xff4\xc34\xee\xb0O\x98\xcf\xde\xb0U\n\xaa\x08\x9e\xbev\x87KV$E\xa5\xdd\xbc6\x87C4\x8b g\xdb\xf9]\xa2\xc9\xc5Mo\xdd\x089\x00\x89\xb8\xc3\xbc\x94\xc2\xf6V\xb0\xd7\xd0(\x10ce1mO\x85\xfb\x86\x85m\x99v\xaa\x81nZ\xac\x0c\x19\x90\x00\xd8\xd1\x9b\x1e+\x9c:\xa8f\xd9\xd3\xa5\x9f\xb0\x02M<\xe3\xf1\x15JW\xc7\xa8\xb6\x99\x1d\xbe\xc3\xd65G\xb1\xb3\x81#\x10l\xccD\x04\x9c\xbc\xa2\xe3\x01;\xcb\x88\x85\xc9\xc8>\xe4\x9b\x87\rsZ\x8bj3\xe00\xb1J\x1a\x8fR\xf3(X\x962\xcc\x81w\xa0\xde6V\xb5\x93O\xb2\xa7:\x12\xde\xc6\xd0\xe1\xe1\xdfe[\xc3\r\xa8\xcd\xb5!7\xdb+#@\xe7Fe\x11\x1f\xc3\xf6h\x94BG\xe1\xa4R\xdb\xb6&Cx2\x0f\x8b\xbc\xed\xeb&"\xc2\xdbI\x10\xf9\x94\x1a\xf9\x1dy\x92\n\xdf\xac\xe4\xd6\x84\xe5\xbaQ\x98\xb6\x1f@\xe9\xe8G{-v\xa2\x88\x0b\x91<\xb3S\x06\\\xed\xa3\x84\x04\x1f\x90\x8f0\x82\x11\x03\xc5\xb8\xec\x7f\'F(\xe9\x14H\xa2\x94\xd1%REF+\xf0^\xad\x95\xf2Kp\x84\x1d\xf8\xedm\xeb\xa6\xd8q\xbf\x1d\x18X,oo\xc7,W\xc5\x9b\x88Fx\xc4\xb6\xfb\xec|sMB\xd7\x99\xfe\xbb\xca\xe6uH\x87{\xec\xa0\xe6>\x1a\xabhb\x93\x04\xf7\xd1\xd8\xce\x19\xdc|@\xad\xa0v\x02\x8c\xd7\x17\x997\'Lh\x1b\x08uL+\xad\x96\x82\xf1:\xf9\x14\xe6\xbe\x85\xb9/\xb6\xa3\xb5}\xc6+\x1b\xf2%l\xc8\xeb\xeb\x9f\x95\x90$\xd7\xf8\x81\x04=$\\j\xee\xb6\x06v\xc6\x16\xb2\x96HE\xf9\xf6\xfb\xd4\xad\x89m\x0c\x12\xca\xfc\x81\xa6!\x0b\xaf\xd34\xf4\x99\xd9\xc0R\xc1\xa4<v\xb8\xdb\x10;U{L\xf9\x85!p\xd8\x9b)\xfe6\xc6\xfe\xa1\x13\xe6`\x8d\xbb\xcd\xa1=\xf8n\xd0gs\xfc\xbbA\x8f9v\xd0\xfb\xc5 \xef^\xf3\xcc\x87c\xdck\x9e1\xc7\xc8\x05\xa53eI\xf0\x82\xe5\x99bX\xde\xbdQ\x1dv@\x8d\x82\x0c\xcfAj8\xd6S\xa1<\xeeS\xd4\x85=\xfe\xb2\xa77\xcb)\xe0\xa7B\x84\x80TX\xb6\r\xdfu"\x81\xb3\x95\xa8]\xed\xc4\x8b\xe4n\xfb\n_\xec\r\x89\xb2\xb0-z\xadF\x90\x8c\x10$>h\x0b&\x82j\r\x81\xb1\xf5W;r\xf4\xb3J\x89q\xff\x05\xa4\xc8\xdd\x7f\x14u\xb4\x04\x00\x00\x01DPLTE\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x08\x08\x08\x00\x00\x00\x00\x00\x00\x0b\x0b\x0b\x0b\x0b\x0b\x08\x08\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x07\x07\x04\x04\x04\x00\x00\x00\x00\x00\x00\x14\x14\x14\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x07\x07\x07\x03\x03\x03\x00\x00\x00\n\n\n\x07\x07\x07\x07\x07\x07\x00\x00\x00\x00\x00\x00\x03\x03\x03\x00\x00\x00\x07\x07\x07\x03\x03\x03\x00\x00\x00\x07\x07\x07\x00\x00\x00\x03\x03\x03\x00\x00\x00\x03\x03\x03\x03\x03\x03\x06\x06\x06\x00\x00\x00\x03\x03\x03C@\xfa\x00\x00\x00\x06\x06\x06\x03\x03\x03\x00\x00\x00\x03\x03\x03\x00\x00\x00\x0c\x0c\x0c\x0f\x0f\x0f\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x0b\x0b\x0b\x11\x11\x11\x00\x00\x00\x00\x00\x00\x03\x03\x03\x03\x03\x03\x00\x00\x00\x06\x06\x06\x10\x10\x10DA\xffA>\xf2\x00\x00\x00\xf3W"\xff\xff\xff\x1f\x0cN1\x00\x00\x00\x01tRNS\x00@\xe6\xd8f\x00\x00\x00\x01bKGD\x00\x88\x05\x1dH\x00\x00\x00\tpHYs\x00\x00\r\xd7\x00\x00\r\xd7\x01B(\x9bx\x00\x00\x00\x07tIME\x07\xe2\x0b\x02\x0f\x0b\x15\xcf\xf4\x93\xae\x00\x00\x04OIDATx\xda\xed\xd4\xb1\r\x80@\x0c\x04\xc1/\xf1\xbb \xa0\xff\x9c\x9c\x08}\x84\xbc\xb3%\xf8F^K\x92$I\x92$I\x92$I\x92$I\x92$I\x92$I\x92$I\x92$\xe9kw*{\xd7\x16\xe7\xc1\xecm\n\xa6\xcdB0f\x96\x81\x01\xc3\x0c\xcc\x16F`\xae0\x023\x95\x11\xd8\xa7l\xc02e\x036)\x1b\xb0F\xda\x80!\xd2\x04\x8c\x90&`\x804\x01\xc7O\x13p\xf84\x01Go\x13p\xf1\xb4\x00\xe7n\x13p\xeb\xb6\x00\x97N\x0bp\xe66\x017n\x0bp\xe1\xb6\x00\xf7m\x0bp\xdd\xb6\x00\xb7m\x0bp\xd9\xb6\x00wm\x0bp\xd5\xb6\x007m\x0bp\xd1\xb8\x00\x07m\x03p\xcf\xb6\x00\xd7l\x0bp\xcb\xb8\x00\xa7l\x03p\xc9\xb6\x00w\x04@a\x01\xae\x18\x17\xe0\x88m\x00n\x18\x17\xe0\x84m\x00.\x18\x17\xe0\x80m\x00\xee\x17\x17\xe0|m\x00\xae\x17\x17\xe0xm\x00n\x17\x17\xe0t\x00(\x0c\xc0\xe5\xe2\x02\x1c\x0e\x00\x85\x01\xb8[\\\x80\xb3\x01\xa00\x00W\x8b\x0bp4\x00\x14\x06\xe0fq\x01N\x06\x80\x00P\x15\x80\x8b\xc5\x058\x18\x00\x02@U\x00\xee\x15\x17\xe0\\\x00\x08\x00U\x01\xb8V\\\x80c\x01 \x00\x04\x80\x00P\x0f\x80[\xc5\x058\x15\x00\x02@\x00\x08\x00\xf5\x00\xb8T\\\x80C\x01 \x00\x04\x80\x00\x10\x00\x02@%\x00\xee\x14\x17\xe0L\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\r\x00\xae\x14\x17\xe0H\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x86\x02p\xa3\xb8\x00\'\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x9c\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00p"\x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01\xa0\x9f\x03  \xbe?\x00\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x00\x08\x00\x01 \x00\x04\x80\xc6\x02  \xbe?\x00\x00\x08\x00\x01 \x00\x04\x80\x00\x10\x00\x02@\x15\x00\x04\xc4\xf7\x07\x00\x00\x01 \x00\x04\x80\x00\x10\x00j\x01  \xbe?\x00\x00\x08\x00\x01 \x00T\x04@@|\x7f\x00\x00\x10\x00\x02@\x00hJ{\x11\xe0\x01\x00\x00\x00\x00\x00\x00\x00\x00\x01\xf6\x07\x00\x00\x00\x00\x00\x00\x00\x02\xec\x0f\x00\x00\x00\x00\x00\x00\x00\x04\xd8\x1f\x00\x00\x00\x00\x80\x80\xfa\xfe\x00\x00\xa04\x00\x02\xe2\xfb\x03\x00\x80\xd2\x00\x08\x88\xef\x0f@\x1d\xc0v\xbb6\x00/ \xbe?\x00u\x00\x04\xc4\xf7\x07\xa0\x0e\x80\x80\xf8\xfe\x00\xd4\x01\x10\x10\xdf\x1f\x80:\x00\x02\xe2\xfb\x03P\x07@@|\x7f\x02\xea\xfb\x03P\x07@@|\x7f\x00\xea\x00\x08\x88\xefO@}\x7f\x02\xea\xfb\x03P\x07@@|\x7f\x02\xea\xfb\x13P\xdf\x9f\x80\xfa\xfe\x04\xd4\xf7\'\xa0\xbe?\x01\xf5\xfd\t\xa8\xefO@}\x7f\x02\xea\xfb#P\x9f\x9f\x80\xfc\xfe\x04\xd4\xf7G\xa0>?\x02\xf9\xf9\t\xc8\xef\x8f@}~\x04\xf2\xf3#\x90\x9f\x1f\x81\xfc\xfc\x0c\x98\x1f\x81\xfa\xfa\x0cX\x9f\x01\xeb3`}\x08\x8c\x0f\x81\xf1)\xb0=\x05\xb6\x7fuY\xb3:\xbd\x7f`x\x14\xcc\x0e\x84\xc1%I\x92$I\x92$I\x92$I\x92$I\x92$I\x92$I\x92$I\xd2Y\x0f\xd1k\xc0\xf2;\x18\x95\xa1\x00\x00\x00\x00IEND\xaeB`\x82'

# create working directories
def verifydirs(sizelist):
    for folder in sizelist:
        path = str(Path.home()) + '/.local/share/icons/Yaru/' + folder + '/apps'
        Path(path).mkdir(parents=True, exist_ok=True)

# the function that does the actual work
def generate(icon, output):
    with Image(blob=background) as _background:
        with Drawing() as draw: 
            draw.fill_color = Color('rgb'+ str(ColorThief(icon).get_palette(color_count=2)[palette]))
            draw.color(256,256,'replace')
            draw(_background)
        with Image(filename=icon) as _icon:
            with Color('rgb'+ str(ColorThief(icon).get_palette(color_count=2)[palette])) as _color:
                _background.resize(_icon.width, _icon.height)
                _background.transparent_color(_color, alpha=alpha_value, fuzz=int(65535 * fuzz_value))
                _icon.resize((_icon.width*percentage)//100, (_icon.height*percentage)//100)
                _background.composite_channel('default_channels', _icon, 'over', _background.width//2-_icon.width//2, _background.height//2-_icon.height//2)
                _background.save(filename=output)

# check if there is a Suru icon already
def isFound(icon, size):
    size2x = str(int(size.split('x')[0])//2) + 'x' + str(int(size.split('x')[0])//2) + '@2x'
    usr = '/usr/share/icons/Yaru/' + size + '/apps/' + icon
    local = str(Path.home()) + '/.local/share/icons/Yaru/' + size + '/apps/' + icon
    usr2x = '/usr/share/icons/Yaru/' + size2x + '/apps/' + icon
    local2x = str(Path.home()) + '/.local/share/icons/Yaru/' + size2x +'/apps/' + icon
    return Path(usr).is_file() or Path(local).is_file() or Path(usr2x).is_file() or Path(local2x).is_file()

# check if the icon should be excluded
def isExcluded(icon):
    flag = False
    for string in exclude:
        if string in icon:
            flag = True
            break
    return flag

# search and generate
def main(hicolor):
    for folder in hicolor:
        for icon in listdir('/usr/share/icons/hicolor/' + folder + '/apps'):
            if not(isFound(icon, folder) or isExcluded(icon) or ("png" not in icon)):
                _icon = '/usr/share/icons/hicolor/' + folder + '/apps/' +icon
                _output = str(Path.home()) + '/.local/share/icons/Yaru/' + redirect[folder] +'/apps/'+icon
                generate(_icon, _output)

# a hackish way to refresh icon cache after generating the new icons
def refresh():
    if Gio.Settings('org.gnome.desktop.interface').get_value('icon-theme').unpack() == 'Yaru':
        Gio.Settings('org.gnome.desktop.interface').set_string ('icon-theme', 'Yaru')

verifydirs(sizelist)
main(hicolor)
refresh()
